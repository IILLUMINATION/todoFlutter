import 'package:flutter/material.dart';
import 'package:signals/signals.dart';
import 'package:todo_flutter/screens/menu_screen.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  final tasks = signal({});
  print(tasks.value);

  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(home: MenuScreen(), debugShowCheckedModeBanner: false);
  }
}
import 'package:signals/signals_flutter.dart';
import 'package:todo_flutter/models/todo.dart';
import 'package:uuid/uuid.dart';

final todoController = TodoController();

class TodoController {
  final _tasks = listSignal<Todo>([]);
  //объявляем пустой контроллер на основе класса туду

  ReadonlySignal<List<Todo>> get tasks => _tasks;
  //это типо чтобы геттер был публичным то есть можно только брать, а записывать нельзя

  void addTodo(String title) {
    if (title.trim().isEmpty) return;

    final newTodo = Todo(id: Uuid().v4(), title: title, isDone: false);

    _tasks.add(newTodo);
  }
  //добавление задачи

  //удаление задачи
  void removeTodo(String id) {
    //копируем в отдельный локал лист т.к нельзя работать с реактивностью
    List<Todo> allTasks = _tasks.value;
    List<Todo> safeTasks = [];

    for (int i = 0; i < allTasks.length; i++) {
      Todo task = allTasks[i];

      if (task.id != id) {
        safeTasks.add(task);
      }
    }

    _tasks.value = safeTasks;
  }

  //изменение статуса задачи
  void changeStatus(String id) {
    List<Todo> allTasks = _tasks.value;
    List<Todo> safeTasks = [];

    for (int i = 0; i < allTasks.length; i++) {
      Todo task = allTasks[i];

      if (task.id == id) {
        Todo newTask =
            Todo(id: task.id, title: task.title, isDone: !task.isDone);
        safeTasks.add(newTask);
      } else {
        safeTasks.add(task);
      }
    }
    _tasks.value = safeTasks;
  }
}
class Todo {
  final String id;
  final String title;
  final bool isDone;

  Todo({required this.id, required this.title, required this.isDone});

  Todo copyWith({String? title, bool? isDone}) {
    return Todo(
        id: id, title: title ?? this.title, isDone: isDone ?? this.isDone);
  }
}
import 'package:flutter/material.dart';
import 'package:todo_flutter/utils/common.dart';

class AddTaskScreen extends StatefulWidget {
  const AddTaskScreen({super.key});

  @override
  State<AddTaskScreen> createState() => _AddTaskScreenState();
}

class _AddTaskScreenState extends State<AddTaskScreen> {
  late final TextEditingController _textController;

  @override
  void dispose() {
    _textController.dispose();
    super.dispose();
  }

  @override
  void initState() {
    super.initState();
    _textController = TextEditingController();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Colors.black,
      body: Padding(
        padding: const EdgeInsets.all(40),
        child: Center(
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              Text(
                "Добавить задачу",
                style: TextStyle(color: Colors.white, fontSize: 30),
              ),
              SizedBox(
                height: 30,
              ),
              TextField(
                decoration: InputDecoration(labelText: "Введите задачу"),
              ),
              SizedBox(
                height: 30,
              ),
              ElevatedButton(
                  onPressed: () {
                    addTask(_textController.text);
                    Navigator.pop(context);
                  },
                  child: Text("Готово"))
            ],
          ),
        ),
      ),
    );
  }
}
import 'package:flutter/material.dart';
import 'package:signals/signals_flutter.dart';
import 'package:todo_flutter/controllers/todo_controller.dart';
import 'package:todo_flutter/screens/add_task_screen.dart';
import 'package:todo_flutter/utils/common.dart';
import 'package:todo_flutter/widgets/todo_widget.dart';

class MenuScreen extends StatefulWidget {
  const MenuScreen({super.key});
  //конструктор класса
  //класс наследуется от StatefulWidget изменяемый виджет который не статичен

  @override
  //переопределяем стандартный метод

  //State обязателен для стейтфула. создаёт объект состояния
  State<MenuScreen> createState() {
    return _MenuScreenState();
    //возвращаем в качестве состояния наш собственный самописный класс
  }
}

//класс состояния и билда отображения, наследуется от State
class _MenuScreenState extends State<MenuScreen> {
  //указываем тип виджета с которым связано состояние через <>
  late final TextEditingController _textController;

  //лейт это значит что мы объявляем переменную и пока что там нету данных но мы обещаем флаттеру что будут позже

  //переопределяем стандартные методы, нужно чтобы не было утечек памяти связанных с текстовым полем
  @override
  //инициализация состояния
  void initState() {
    super.initState();
    //чёто типо стандартного бойлерпринта всегда нужно писать в первую очередь кроме диспосе по моему
    _textController = TextEditingController();
    //объявляем контрллер текстовому полю
  }

  //тут всё плюс минус также
  @override
  void dispose() {
    _textController.dispose();
    //вызываем его уже после очистки
    super.dispose();
  }

  //переопределяем стандартный метод билд
  @override
  Widget build(BuildContext context) {
    //возвращаем виджет скаффолд типо шаблон базового экрана база крч
    return Scaffold(
      //ставим цвет фона
      backgroundColor: Colors.black,
      //указваем тело и делаем внутренности по центру
      body: Center(
        child: Column(
          //стандартную центровку ставим на центр по y так как это колумн ряд крч
          mainAxisAlignment: MainAxisAlignment.center,
          //заполняем детей
          children: [
            //просто пустота для красоты
            SizedBox(
              height: 50,
            ),
            //название прилоения
            Text(
              "TODO",
              style: TextStyle(color: Colors.white, fontSize: 30),
            ),
            //пустота
            SizedBox(
              height: 20,
            ),
            //даём с помощью экспандеда вотчу расшириться на фулл пространство
            Expanded(
              //ставим вотч, он будет наблюдать и всё что в нём само перестроится
              child: Watch((context) {
                //список задач с подпиской на реактивность
                //вызываем внутри вотча чтобы было актуально
                final taskList = todoController.tasks.watch(context);

                //проверяем что лист задач пуст, если да то текст юзеру пихаем
                if (taskList.isEmpty) {
                  return const Text(
                    "Пусто, добавь ка задачку",
                    style: TextStyle(color: Colors.white),
                  );
                }

                //если не пуст список билдим через ListView.builder на основе списка всё, это самый проивзодительный способ
                return ListView.builder(
                  //ставим длину списка как у листа нашего
                  itemCount: taskList.length,
                  //в билдере у нас два аргумента контекст и индекс
                  //индекс это текущий элемент
                  itemBuilder: (context, index) {
                    //берём по индексу из листа тудушку
                    final todo = taskList[index];
                    //на основе уже сделанного в другом экране виджета строим всё
                    return TodoWidget(
                      //тут чисто базовые аргументы
                      todo: todo,
                      onDelete: () {
                        //тут указываем что делать при удалении
                        //удаляем по индексу из листа
                        todoController.removeTodo(todo.id);
                      },
                    );
                  },
                );
              }),
            ),

            //пустота
            SizedBox(
              height: 20,
            ),
            //кнопка
            ElevatedButton(
                //функция при нажатии, ну тут опять так вызываем добавление задачи
                onPressed: () {
                  Navigator.push(context,
                      MaterialPageRoute(builder: (context) => AddTaskScreen()));
                },
                //внутренности кнопки
                child: Text("Добавить задачу")),
            //пустота
            SizedBox(
              height: 50,
            )
          ],
        ),
      ),
    );
  }
}
import 'package:todo_flutter/controllers/todo_controller.dart';

addTask(String text) {
  print(text);
  todoController.addTodo(text);

  return true;
}
import 'package:flutter/material.dart';
import 'package:signals/signals_flutter.dart';
import 'package:todo_flutter/controllers/todo_controller.dart';
import 'package:todo_flutter/models/todo.dart';

class TodoWidget extends StatelessWidget {
  final Todo todo;
  final VoidCallback onDelete;

  const TodoWidget({super.key, required this.todo, required this.onDelete});

  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.all(10),
      child: Card(
        color: Colors.blueGrey,
        elevation: 2,
        shape: RoundedRectangleBorder(
            borderRadius: BorderRadiusGeometry.circular(12)),
        child: Padding(
          padding: EdgeInsetsGeometry.symmetric(horizontal: 16, vertical: 8),
          child: Row(
            children: [
              Checkbox(
                  value: todo.isDone,
                  onChanged: (newValue) {
                    todoController.changeStatus(todo.id);
                  }),
              Expanded(
                  child: Text(
                todo.title,
                style: TextStyle(color: Colors.white),
              )),
              IconButton(
                  onPressed: () {
                    showDialog(
                        context: context,
                        builder: (BuildContext context) {
                          return AlertDialog(
                            backgroundColor: Colors.brown,
                            title: Text("Удалить тудушку?",
                                style: TextStyle(color: Colors.white)),
                            content: Text(
                              "Это уже потом не отменить ес что, так к слову",
                              style: TextStyle(color: Colors.white),
                            ),
                            actions: [
                              TextButton(
                                  onPressed: () {
                                    todoController.removeTodo(todo.id);
                                    Navigator.pop(context);
                                  },
                                  child: Text("Удаляй, плевать!!!",
                                      style: TextStyle(color: Colors.white))),
                              TextButton(
                                  onPressed: () {
                                    Navigator.pop(context);
                                  },
                                  child: Text("Чёта передумал...",
                                      style: TextStyle(color: Colors.white)))
                            ],
                          );
                        });
                  },
                  icon: Icon(
                    Icons.remove_moderator,
                    color: Colors.white,
                  ))
            ],
          ),
        ),
      ),
    );
  }
}
